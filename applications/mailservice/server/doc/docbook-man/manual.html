<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Jsmtpd Manual</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.68.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>Jsmtpd Manual</h1></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#d0e4">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7">1. Whats' this ?</a></span></dt><dt><span class="section"><a href="#d0e14">2. Key Features</a></span></dt><dt><span class="section"><a href="#d0e29">3. Modularity - Simplicity</a></span></dt><dt><span class="section"><a href="#d0e50">4. Undesirable mail</a></span></dt><dt><span class="section"><a href="#d0e59">5. Targets</a></span></dt><dt><span class="section"><a href="#d0e66">6. Status</a></span></dt><dt><span class="section"><a href="#d0e71">7. About</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e76">2. Installing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e79">1. Requirements</a></span></dt><dt><span class="section"><a href="#d0e93">2. Get the archive</a></span></dt><dt><span class="section"><a href="#d0e109">3. Package Overview</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e167">3. Basic Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e170">1. Edit the file etc/jsmtpd.ini</a></span></dt><dt><span class="section"><a href="#d0e223">2. Edit the file etc/plugin-config.xml</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e228">2.1. DNSService</a></span></dt><dt><span class="section"><a href="#d0e240">2.2. Acces Control List</a></span></dt><dt><span class="section"><a href="#d0e257">2.3. MailboxWriter</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e266">3. What you should have now</a></span></dt><dt><span class="section"><a href="#d0e273">4. Startup</a></span></dt><dt><span class="section"><a href="#d0e278">5. Notes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e283">4. Advanced Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e286">1. Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e289">1.1. General informations</a></span></dt><dt><span class="section"><a href="#d0e312">1.2. Diagram</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e322">2. Filtering Concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e325">2.1. What is a filter ?</a></span></dt><dt><span class="section"><a href="#d0e332">2.2. Filter instances</a></span></dt><dt><span class="section"><a href="#d0e337">2.3. The IP input filter chain</a></span></dt><dt><span class="section"><a href="#d0e342">2.4. The body filter tree</a></span></dt><dt><span class="section"><a href="#d0e349">2.5. Additionnaly - ACL</a></span></dt><dt><span class="section"><a href="#d0e361">2.6. Remember</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e366">3. Advanced Setup</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e369">3.1. Enabling TLS (SSL)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e372">3.1.1. What is TLS ?</a></span></dt><dt><span class="section"><a href="#d0e377">3.1.2. Keystore</a></span></dt><dt><span class="section"><a href="#d0e382">3.1.3. Creating a certificate</a></span></dt><dt><span class="section"><a href="#d0e429">3.1.4. Self signed Certificate</a></span></dt><dt><span class="section"><a href="#d0e442">3.1.5. Configure Jsmtpd</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e451">3.2. Enabling SMTP authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e454">3.2.1. Configure user/passwords</a></span></dt><dt><span class="section"><a href="#d0e463">3.2.2. Extension</a></span></dt><dt><span class="section"><a href="#d0e475">3.2.3. Secured authentication ?</a></span></dt><dt><span class="section"><a href="#d0e480">3.2.4. Example</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e487">5. Typical Use Case</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e490">1. Antivirus/Antispam : ClamAV/Spamassassin</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e493">1.1. Scenario</a></span></dt><dt><span class="section"><a href="#d0e498">1.2. Summary</a></span></dt><dt><span class="section"><a href="#d0e507">1.3. Filter Setup</a></span></dt><dt><span class="section"><a href="#d0e522">1.4. ClamAV Setup</a></span></dt><dt><span class="section"><a href="#d0e533">1.5. SpamAssassin Setup</a></span></dt><dt><span class="section"><a href="#d0e544">1.6. ChainSucces Setup</a></span></dt><dt><span class="section"><a href="#d0e555">1.7. Build up the filter tree</a></span></dt><dt><span class="section"><a href="#d0e564">1.8. Let's go</a></span></dt><dt><span class="section"><a href="#d0e573">1.9. Files</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e580">6. Plugin Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e583">1. Input IP Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e586">1.1. Blacklist</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e589">1.1.1. Description</a></span></dt><dt><span class="section"><a href="#d0e594">1.1.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e599">1.1.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e609">1.1.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e614">1.1.5. Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e624">1.2. RBLFilter</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e627">1.2.1. Description</a></span></dt><dt><span class="section"><a href="#d0e632">1.2.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e637">1.2.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e647">1.2.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e652">1.2.5. Parameters</a></span></dt><dt><span class="section"><a href="#d0e662">1.2.6. Notes</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#d0e667">2. Body Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e670">2.1. ClamAV, Clam antivirus filter</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e673">2.1.1. Description</a></span></dt><dt><span class="section"><a href="#d0e678">2.1.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e683">2.1.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e693">2.1.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e698">2.1.5. Parameters</a></span></dt><dt><span class="section"><a href="#d0e722">2.1.6. See Also</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e729">2.2. SA, Spamassassin anti spam filter</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e732">2.2.1. Description</a></span></dt><dt><span class="section"><a href="#d0e737">2.2.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e742">2.2.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e752">2.2.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e757">2.2.5. Parameters</a></span></dt><dt><span class="section"><a href="#d0e781">2.2.6. See Also</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e788">2.3. Jasen anti spam filter</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e791">2.3.1. Description</a></span></dt><dt><span class="section"><a href="#d0e796">2.3.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e801">2.3.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e811">2.3.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e816">2.3.5. Parameters</a></span></dt><dt><span class="section"><a href="#d0e825">2.3.6. See Also</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e837">2.4. RcptMatcher Filter</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e840">2.4.1. Description</a></span></dt><dt><span class="section"><a href="#d0e845">2.4.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e850">2.4.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e860">2.4.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e865">2.4.5. Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e889">2.5. RcptRewrite Filter</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e892">2.5.1. Description</a></span></dt><dt><span class="section"><a href="#d0e897">2.5.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e902">2.5.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e909">2.5.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e914">2.5.5. Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e928">2.6. LdapBodyRewriter</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e931">2.6.1. Description</a></span></dt><dt><span class="section"><a href="#d0e936">2.6.2. Filter Type</a></span></dt><dt><span class="section"><a href="#d0e941">2.6.3. Responses</a></span></dt><dt><span class="section"><a href="#d0e948">2.6.4. Class Name</a></span></dt><dt><span class="section"><a href="#d0e953">2.6.5. Parameters</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#d0e987">3. Acces Control List</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e990">3.1. SimpleACL, config file based</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e993">3.1.1. Description</a></span></dt><dt><span class="section"><a href="#d0e998">3.1.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1003">3.1.3. Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1017">3.2. LdapACL, ldap directory based</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1020">3.2.1. Description</a></span></dt><dt><span class="section"><a href="#d0e1025">3.2.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1030">3.2.3. Parameters</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#d0e1089">4. DNS Service</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1092">4.1. DNSJava resolver</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1095">4.1.1. Description</a></span></dt><dt><span class="section"><a href="#d0e1100">4.1.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1105">4.1.3. Parameters</a></span></dt><dt><span class="section"><a href="#d0e1114">4.1.4. See also</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#d0e1121">5. DeliveryServices</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1124">5.1. Mailbox Writer</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1127">5.1.1. Description</a></span></dt><dt><span class="section"><a href="#d0e1132">5.1.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1137">5.1.3. Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1146">5.2. RemoteSmtpSender</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1149">5.2.1. Description</a></span></dt><dt><span class="section"><a href="#d0e1154">5.2.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1159">5.2.3. Parameters</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#d0e1168">6. SMTP Extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1171">6.1. TLS Switcher</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1174">6.1.1. Description</a></span></dt><dt><span class="section"><a href="#d0e1179">6.1.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1184">6.1.3. Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1198">6.2. Basic SMTP Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1201">6.2.1. Description</a></span></dt><dt><span class="section"><a href="#d0e1206">6.2.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1211">6.2.3. Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1225">6.3. LDAP SMTP Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1228">6.3.1. Description</a></span></dt><dt><span class="section"><a href="#d0e1233">6.3.2. Class Name</a></span></dt><dt><span class="section"><a href="#d0e1238">6.3.3. Parameters</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e1272">7. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1275">1. Why can't I check the incoming mails ?</a></span></dt></dl></dd></dl></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e4"></a>Chapter&nbsp;1.&nbsp;Introduction</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7"></a>1.&nbsp;Whats' this ?</h2></div></div></div><p>Jsmtpd is a compact SMTP daemon (Email server), entirely written in Java. It is basicly able to receive E-mail following the SMTP protocol, described in RFC 821. Each others functionnalities are implemented as plugin modules, allowing the core to remain small and easily understaindable.</p><p>As now, Jsmtpd is able to receive mail, check it's recipients (ACL-SimpleACL plugin), check for viruses (filters-ClamAVFilter, connects to a ClamAV daemon), check for spam using the Java Jasen engine (filters-JasenAntiSpamFilter) or a spamassassin daemon, check senders via RBL plugin or blacklist plugin. Emails can be delivered localy using the mailbox writer (DeliveryServices-UnixMailboxWriter), or to a remote STMP server (DeliveryServices-RemoteSmtpSender). DNSQueries are also provided by a plugin (DNSJava).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e14"></a>2.&nbsp;Key Features</h2></div></div></div><p>Jsmtpd comes with three main services :</p><div class="itemizedlist"><ul type="disc"><li><p>The receiver service : It's job is to listen for incoming STMP connection, chat with the client in order to receive E-mails according to ACL plugin.</p></li><li><p>The second service is the mail queue services. It holds the received mails (loaded or writen to disk). Whenever possible, it processes mails to the delivery service.</p></li><li><p>The delivery service is a filter plugin tree ending by a delivery service. A filter is basicly a piece of code that answers yes or not to an incoming email. Mails are then checked agains theses plugins, following a tree model. A the end of the chain, the mail is droped if it does not match the filters, or a delivery plugin is invoked to deliver the mail. For now, only two delivery services can be routed using the ACL plugin : local or remote mail.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e29"></a>3.&nbsp;Modularity - Simplicity</h2></div></div></div><p>Jsmtpd's design is heavily based on plugins. Most functionnalities are implemented as plugins. Plugins interfaces are simple to understaind and implement. With minimal time spent learning Jsmtpd, you can rewrite how Jsmtpd handles :</p><div class="itemizedlist"><ul type="disc"><li><p>Dns queries</p></li><li><p>Acces control list (who can do what on the runnning server)</p></li><li><p>Deliveries : you want to put your mail directly into your custom application ? Write a plugin !</p></li><li><p>IP filtering</p></li><li><p>Mail filtering</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e50"></a>4.&nbsp;Undesirable mail</h2></div></div></div><p>This server is designed to provide efficient ways to stop unsollicited mail or mail containing viruses. A Jsmtpd deamon can't be set as open relay ( you'll have to write a plugin to do so ;).</p><p>Filtering spam can be done at two levels. Ip based filtering will reject connections from well known spammers or open relais smtp servers (ie misconfigured mail servers used by spammers to relay their mails). Content based filtering allows to check mail containing spam (using Spamassassin or Jasen) or viruses (using Clam Antivirus).</p><p>If you can't find a filter matching your needs, you can easily write your own and plug it in Jsmtpd.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e59"></a>5.&nbsp;Targets</h2></div></div></div><p>Jsmtpd is intended to remain small, understaindable and (quite) fast. Without using filters plugin, minimal process is applied to the email data, providing best performances. If you need a more powerfull (in terms of functionnalities) email service solution, I recommend you to check out the jakarta James project and their mailet API.</p><p>This server runs over a Java Virtual Machine, and should make intrusions like buffer overflow more difficult to success.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e66"></a>6.&nbsp;Status</h2></div></div></div><p>Jsmtp is currently in alpha stage, consider it unstable. This document is updated when new features are added, and is now incomplete.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e71"></a>7.&nbsp;About</h2></div></div></div><p>This software is developped by Jean-Francois POUX (jfp@jsmtpd.org). It is licenced under GPL Licence. The documentations are available under Creative Common Licence. Drop me a mail if you have any questions, suggestions, positive or negative feedback, it'll help improving the project.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e76"></a>Chapter&nbsp;2.&nbsp;Installing</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e79"></a>1.&nbsp;Requirements</h2></div></div></div><p>Binaries versions of jsmtpd are compiled using a Sun JDK version 1.5 (or version 5.0, according to their new version numbering), so you'll need the corresponding Runtime Environement from Sun, you can get it at <a href="http://java.sun.com/j2se/1.5.0/download.jsp" target="_top">http://java.sun.com/j2se/1.5.0/download.jsp</a>, the runtime environement (JRE) is suffisant if you use the binaries, pick the developement kit (JDK) if you want to build jsmtpd from the sources.</p><p>Install your Java environment, and have java in your path. To do so under Windows platforms(xp, 2k), right click on my computer, properties, go to advanced tab, environement, locate the Path variable, edit and add your path to JVM install (something like c:\Programe Files\java\jdkxxx\bin). On Linux platforms, edit your .profile file (or /etc/profile as root) and add your java install to your path (something like /usr/java/jdkxxx/bin), and don't forget to logout/login or include the modified file with ". .profile".</p><p>You'll also need an internet domain name if you wish to receive mail (MX configuration should be present), correctly configured. You'll also need a DNS (Domain Name Server) in order to get name resolution.</p><p>Jsmtpd by itself does not require much ressources (128Mo Ram), but it can run much more faster with a bit of ram. Additionnals plugins like the Jasen anti spam engine uses much more ressources.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e93"></a>2.&nbsp;Get the archive</h2></div></div></div><p>You may want to look at the files releases to get the latest release of Jsmtpd. You can get zip, tar.gz or tar.bz2 archive there :</p><div class="itemizedlist"><ul type="disc"><li><p>File releases : <a href="http://www.jsmtpd.org/ipage.php?module=download" target="_top">http://www.jsmtpd.org/</a></p></li><li><p>Auto build from source repository (likely unstable) : <a href="http://www.taldius.net/~jef/Jsmtpd_autobuild" target="_top">http://www.taldius.net/~jef/Jsmtpd_autobuild</a></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e109"></a>3.&nbsp;Package Overview</h2></div></div></div><p>Once you have the Jsmtpd archive, uncompress it. You'll get several directories :</p><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th align="center">Folder</th><th align="center">Description</th></tr></thead><tbody><tr><td>etc/</td><td>Contains the configuration files, you'll find jsmtpd.ini (core config) and plugin-config.xml</td></tr><tr><td>log/</td><td>When running, the cores produces a logg file of what's happening, you can find it here</td></tr><tr><td>mailboxes/</td><td>Local mails are by default writen to this directory, using mbox format</td></tr><tr><td>tmp/</td><td>When runnning, mails may be temporary written to this directory. It can happen if a delivery fails (mail is requeued for later),or if Jsmtpd uses to much ram.</td></tr><tr><td>pugins/</td><td>This directory contains the plugin binary archives.</td></tr><tr><td>src/</td><td>The sources of Jsmtpd</td></tr><tr><td>doc/</td><td>Documentation, javadoc, etc.</td></tr><tr><td>safeModeFolder/</td><td>Dump incoming mails to this folder (usefull with unstable builds)</td></tr></tbody></table></div><p>You'll also find a startup.bat or startup.sh to run Jsmtpd according to your platform. Now, you should look at <a href="#basiconf">Basic setup</a></p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e167"></a>Chapter&nbsp;3.&nbsp;Basic Configuration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e170"></a>1.&nbsp;Edit the file etc/jsmtpd.ini</h2></div></div></div><p>Change the <span class="bold"><strong>localHost</strong></span> to match your hostname, this has to be a MX record if you wish to receive mail.</p><p>You may change <span class="bold"><strong>temporaryFolder</strong></span> to somewhere you have enough disk space, just copy the directory structure inside the tmp/ distribution to the new location. The user running Jsmtpd must have read/write/execution rights in this directory.</p><p><span class="bold"><strong>maxTemporarySize</strong></span> set the amount of disk space (in Mo) that Jsmtpd will use to store temporary mails. When this amount is exceeded, Jsmtpd will refuse incoming mails.</p><p><span class="bold"><strong>logType</strong></span> configures where Jsmtpd puts its log. Set to file (log is written to log/jsmtpd.log), console or debug for both. <span class="bold"><strong>logLevel</strong></span> sets the level of log to be kept. Possible values are : debug, info, warning, error, fatal, from the most verbose to the least. If you chose to log to a file, use logFile to set up the file where to write the data.</p><p><span class="bold"><strong>connectionTimeout</strong></span> sets the amount of time in seconds when an iddle connection should be droped.</p><p>Use the <span class="bold"><strong>rPort</strong></span> to set up the TCP port where Jsmtpd should be waiting for connections. By default, the SMTP protocol is bound to port 25. On Unixes, it requires a special right to bind to a port lower than 1024, Jsmtpd will report you this error if it occurs.</p><p><span class="bold"><strong>maxMessageSize</strong></span> sets the maximum message in Mo, mails exceding this limit will be refused.</p><p><span class="bold"><strong>rMaxInstances</strong></span> sets the maximum number of receiver thread to be working at the same time. A low setting may cause mails to be refused, a higher setting will use more memmory. It can use maxMessageSize * rMaxInstances for receiving in the worst case.</p><p><span class="bold"><strong>dMaxInstances</strong></span> sets the maximum number of delivery services thread to be working at the same time. A low number of threads may cause mails to be stuck into mailqueue, a higher setting will use more ressources.</p><p><span class="bold"><strong>dDelayRetry</strong></span> when Jsmtpd fails to deliver a mail (typically the remove server is no responding, etc..), it will wait this amount of time (in minutes) before retrying</p><p><span class="bold"><strong>dNumRetry</strong></span> each failed attempt to deliver a mail is recorded, when this number is exceeded, the mail is considered as non deliverable, and Jsmtpd will to try to send a mail back to the sender to inform of the failure. The mail is then deleted.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e223"></a>2.&nbsp;Edit the file etc/plugin-config.xml</h2></div></div></div><p>We are going to set up the DNS server to be used, the acces control list and the mailbox writer.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e228"></a>2.1.&nbsp;DNSService</h3></div></div></div><p>Locate the element DNSSetup, it contains a propertyset element, it should look like :</p><pre class="programlisting">&lt;DNSSetup class="org.jsmtpd.plugins.dnsServices.DNSJavaResolver" name="DNS Java"&gt;
    &lt;propertyset name="DnsServers" value="172.16.0.200"&gt;&lt;/propertyset&gt;
&lt;/DNSSetup&gt;</pre><p>Change the <span class="bold"><strong>DnsServers</strong></span> value in propertyset to the ip of you DNS server. You can setup multiple DNS Servers by separating them by comma.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e240"></a>2.2.&nbsp;Acces Control List</h3></div></div></div><p>Locate the element ACLSetup, it containts two propertyset elements that configures the acces control list :</p><pre class="programlisting">&lt;ACLSetup name="Basic ACL" class="org.jsmtpd.plugins.acls.SimpleACL"&gt;
    &lt;propertyset name="RelayedHosts" value="127.0.0.1,localhost,172.16.0.20,172.16.0.23"&gt;&lt;/propertyset&gt;
    &lt;propertyset name="ValidUsers" value="*@localhost,*@mail.taldius.ath.cx"&gt;&lt;/propertyset&gt;
&lt;/ACLSetup&gt;</pre><p>Change the <span class="bold"><strong>RelayedHosts</strong></span> value to add the hosts allowed to send mail throught the server, separate the ip addresses with comma. Keep 127.0.01 and localhost.</p><p>Change the <span class="bold"><strong>ValidUsers</strong></span> value to add the users@domain that Jsmtpd will consider as localhost, eg for itself. you can use the wildcard * to mean any user.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e257"></a>2.3.&nbsp;MailboxWriter</h3></div></div></div><p>Localte the element LocalDeliveryService, it contains one propertyset element that configures the path of mailboxes :</p><pre class="programlisting">&lt;LocalDeliveryService name="umw" class="org.jsmtpd.plugins.deliveryServices.UnixMailboxWriter"&gt;
    &lt;propertyset name="MailDir" value="mailboxes/"&gt;&lt;/propertyset&gt;
&lt;/LocalDeliveryService&gt;</pre><p>Change the MailDir value to the path where mailboxes should be stored. The user running Jsmtpd must have read/write/execute rights to this directory.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e266"></a>3.&nbsp;What you should have now</h2></div></div></div><p>You should now have an xml configuration file that looks like :</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jsmtpdsetup xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="jsmtpd-plugin-config.xsd"&gt;
&lt;!--Note : Configuration is case sensitive --&gt;
&lt;!-- Manual : http://jsmtpd.sourceforge.net/user-man/index.html --&gt;

&lt;!-- Initialise the Acces Control List (Who can use the smtp server and who are are local users) --&gt;
&lt;ACLSetup name="Basic ACL" class="org.jsmtpd.plugins.acls.SimpleACL"&gt;
  &lt;propertyset name="RelayedHosts" value="127.0.0.1,localhost,192.168.1.0/255.255.0.0"/&gt;
  &lt;propertyset name="ValidUsers" value="*@localhost,*@yourdomain.com"/&gt;
&lt;/ACLSetup&gt;
&lt;!-- Set up the Domain Name Service. Change to your dns IP --&gt;
&lt;DNSSetup class="org.jsmtpd.plugins.dnsServices.DNSJavaResolver" name="DNS Java"&gt;
  &lt;propertyset name="DnsServers" value="172.16.0.200"/&gt;
&lt;/DNSSetup&gt;
&lt;!--Local Delivery service. unix mailbox writer writes the incoming mail to mailbox format in the MaiDir directory MailDir has to be writable. --&gt;
&lt;LocalDeliveryService name="umw" class="org.jsmtpd.plugins.deliveryServices.UnixMailboxWriter"&gt;
  &lt;propertyset name="MailDir" value="mailboxes/"/&gt;
&lt;/LocalDeliveryService&gt;
&lt;!-- Remote Devliery service handles mails not from local domain --&gt;
&lt;RemoteDeliveryService name="Remote smtp sender" class="org.jsmtpd.plugins.deliveryServices.RemoteSmtpSender"&gt;
&lt;/RemoteDeliveryService&gt;

&lt;!-- Initialises the filter plugins --&gt;
&lt;filtersetup&gt;&lt;/filtersetup&gt;

&lt;smtpExtensions&gt;&lt;/smtpExtensions&gt;

&lt;!-- IP filtering, plugins are executed in this oder, on failure drops the incoming connection--&gt;
&lt;!-- filter names must be something loaded in the previous section --&gt;
&lt;inputIPFilterChain&gt;&lt;/inputIPFilterChain&gt;

&lt;!-- Filter the email contents folowing this tree, plugin names must be something loaded in filtersetup --&gt;
&lt;bodyFilterTree&gt;&lt;/bodyFilterTree&gt;

&lt;/jsmtpdsetup&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e273"></a>4.&nbsp;Startup</h2></div></div></div><p>Now that you have finished the configuration, you can start the server with startup.sh or startup.bat and look for eventual errors in the log file.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e278"></a>5.&nbsp;Notes</h2></div></div></div><p>Emails are in most cases small (in terms of size), so the current implementation of Jsmtpd tries at most to keep mails loaded in memory, whenever possible. So, Jsmtpd may occasionnaly use much ram (peaks) while processing big messages. This is a design decision, althought a transparent swapping may be added in future releases. In the worst case, it will uses about 30meg(depending on the plugins) + (number of receiver thread + number of sender threads + 10 ) * maximum message size. This changes depending on the plugins loaded.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e283"></a>Chapter&nbsp;4.&nbsp;Advanced Configuration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e286"></a>1.&nbsp;Architecture</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e289"></a>1.1.&nbsp;General informations</h3></div></div></div><p>Jsmtpd works in several times, each one is a service :</p><div class="orderedlist"><ol type="1"><li><p>A receiver module listens for incoming connection. Once a client is connected, this module delegates the processing task to a threaded processor.</p></li><li><p>Upon connection, a first IP filter is applied. If this filter fails, the connection is closed. It is used to blacklist hosts (manually, or using real time black list servers).</p></li><li><p>The mail is then received during a smtp chat with the client. Permissions are checked against the ACL module to determine wether or not the mail is to be receive. It is then passed to the delivery service. During this negotiation, the client may also switch to TLS (SSL) mode or authenticate itself against the ACL (feature pending).</p></li><li><p>Whenever ressources are available a mail is pending to be sent, the delivery service delegates it to a delivery handler module (it is threaded).</p></li><li><p>The delivery handler will then apply a body filter tree to the mail (content is examined and might be modified). It determines if the mail is to be handled localy or to be sent to a remote SMTP host, invoking the aproriate plugin.</p></li></ol></div><p>Note that if it has enough memory, Jsmtpd won't even write the mail down to disk, it's directly processed by delivery handlers, allowing good performances.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e312"></a>1.2.&nbsp;Diagram</h3></div></div></div><p>Here is diagram summing up what was said in the last section :</p><div class="figure"><a name="d0e317"></a><p class="title"><b>Figure&nbsp;4.1.&nbsp;</b></p><div class="mediaobject"><img src="resources/archi.jpg"></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e322"></a>2.&nbsp;Filtering Concepts</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e325"></a>2.1.&nbsp;What is a filter ?</h3></div></div></div><p>Basicly, it is small piece of code that answers true or false. By example, the ClamAV filter takes as input the mail, and says true, there are no viruses, or false, a virus is detected.ClamAVFilter is a body filter, ie it checks mail content.</p><p>The RBLPlugin is an IP input filter, used to reject senders only from their originating network address.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e332"></a>2.2.&nbsp;Filter instances</h3></div></div></div><p>In Jsmtpd, the same filter can be used with different configuration. You can define it in the jsmtpd-plugin-config.xml.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e337"></a>2.3.&nbsp;The IP input filter chain</h3></div></div></div><p>As said before, a filter answers true or false. The input filter are connected following a simple chain mode.This chain checking is excuted upon connection of a client, before anything else. A plugin failure will cause the entire chain to be broken, and the connection to be dropped. If the chains ends in succes, the normal SMTP chat can take place.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e342"></a>2.4.&nbsp;The body filter tree</h3></div></div></div><p>In Jsmtpd, the filters are connected to each others following a tree model. A given filter (node) can have one true child, one false child. Each child may be a filter, or nothing. The mail is passed throught the tree of filters. The chain declares the mail valid if the last true child of the last node where the mail passed by is empty. It is false if the last false child of the last node where the mail passed is empty. Additionnaly, there are two specials filters that cause the chain to be immediatly broken : ChainReject (immediate failure) and Chain succes (immeditate succes).</p><p>You can define custom chains in that way, by example classifying a mail as spam can be quite difficult, so you can try a first anti spam filter and if it fails a second.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e349"></a>2.5.&nbsp;Additionnaly - ACL</h3></div></div></div><p>During the SMTP chat, Jsmtpd will reject ALL the incoming mails, except :</p><div class="itemizedlist"><ul type="disc"><li><p>If the sender is allowed to send mail throught the server. Allowed users are granted acces by an acces control list plugin (ACL).</p></li><li><p>If the recipient is for local users. As above, the ACL plugin will determine which users are local</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e361"></a>2.6.&nbsp;Remember</h3></div></div></div><p>Keep in mind that examining a mail content can consume quite a lot of ressources, whereas IP based filtering costs much less ressources. That's why Jsmtp performs simple IP filtering before processing mails, saving ressources.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e366"></a>3.&nbsp;Advanced Setup</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e369"></a>3.1.&nbsp;Enabling TLS (SSL)</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e372"></a>3.1.1.&nbsp;What is TLS ?</h4></div></div></div><p>TLS/SSL is an encryption mecanism over sockets, using signed certifates. It allows a client to chat with Jsmtpd in a secured way. In a basic SMTP support, mails are delivered in plain text. Jsmtpd provides support for the STARTTLS command (RFC 2487), it means that the chat between client and server starts in clear, then the client asks to switch to encrypted layer. The chat goes on over a secured channel.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e377"></a>3.1.2.&nbsp;Keystore</h4></div></div></div><p>Java provides a keystore program to hold your certificates. Jsmtpd uses this mecanism. A keystore is protected by a password. Sun Java's RE includes the keytool program to manage your keystores. The keytool program is available in the binary directory of Sun's JDK, we'll assume that you have this directory on your system path.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e382"></a>3.1.3.&nbsp;Creating a certificate</h4></div></div></div><p>cd to jsmtpd/etc, then type : </p><pre class="programlisting">keytool -genkey -alias jsmtpd -keyalg RSA -keystore keystore</pre><p>It will generate a file (the keystore), and a RSA key in keystore. Questions asked by the keytool program :</p><div class="itemizedlist"><ul type="disc"><li><p>keystore pass : choose one</p></li><li><p>distinguished name/common name (CN): set to the DNS name of your server, by example : smtp.jsmtpd.org</p></li><li><p>organisation unit</p></li><li><p>organisation</p></li><li><p>city</p></li><li><p>state</p></li><li><p>country</p></li><li><p>a password for the key (press enter to use the same as the keystore)</p></li></ul></div><p>Your keystore is now ready. Now you have to choose between :</p><div class="itemizedlist"><ul type="disc"><li><p>Buying a certificate from a certficate authority (CA), like from Verisgn, Thawte</p></li><li><p>Create a self signed certificate</p></li></ul></div><p>You can see what's in a keystore with :</p><pre class="programlisting">keytool -list -keystore keystore -rfc</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e429"></a>3.1.4.&nbsp;Self signed Certificate</h4></div></div></div><p>cd to jsmtpd/etc: </p><pre class="programlisting">keytool -selfcert -keystore keystore -alias jsmtpd -keyalg RSA</pre><p>When connecting to a server using a self signed certificate, it'll say that the certificate is not signed with a CA authority. You can export the server's certificate and set it up on the clients :</p><pre class="programlisting">keytool -export -alias jsmtpd -file jsmtpd-server.cer -keystore keystore</pre><p>It'll generate the jsmtpd-server.cer certificate to import for your clients.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e442"></a>3.1.5.&nbsp;Configure Jsmtpd</h4></div></div></div><p>Locate the element smtpExtensions in etc/jsmtpd-plugin-config.xml, and add something like :</p><pre class="programlisting">&lt;smtpExtension name="tls" class="org.jsmtpd.plugins.smtpExtension.TLSSwitcher"&gt;
   &lt;propertyset name="KeystoreName" value="keystore"/&gt;
   &lt;propertyset name="KeystorePassword" value="demodemo"/&gt;
&lt;/smtpExtension&gt;</pre><p>The property KeystoreName tells the plugin which keystore to use (must be in classpath, a good place is etc/) The KeystorePassword is your keystore password.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e451"></a>3.2.&nbsp;Enabling SMTP authentication</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e454"></a>3.2.1.&nbsp;Configure user/passwords</h4></div></div></div><p>Jsmtpd supportstwo authentication methods (PLAIN/LOGIN) via the !org.jsmtpd.plugins.smtpExtension.BasicSmtpAuth plugin.</p><p>Edit your config file etc/jsmtpd-plugin-config.xml, and locate the smtpExtensions element. Add the following configuration under the element :</p><pre class="programlisting">&lt;smtpExtension name="auth" class="org.jsmtpd.plugins.smtpExtension.BasicSmtpAuth"&gt;
&lt;/smtpExtension&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e463"></a>3.2.2.&nbsp;Extension</h4></div></div></div><p>Now, you need to add users/passwords to this smtpExtension. You can either set login/passwords in clear (bad ;), or encrypted version of the password. In any case, the property is a string containing the user and the password, separated by a coma. Properties :</p><div class="itemizedlist"><ul type="disc"><li><p>PlainUser : Adds the user/password in clear text</p></li><li><p>MD5User : Login is in clear, but the password is the base64 encoded version of the md5 hash of your password. Use the tool org.jsmtp.PasswordGenerator to generate such passwords.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e475"></a>3.2.3.&nbsp;Secured authentication ?</h4></div></div></div><p>With the plain/login methods of authentication, passwords are sent in clear. You can tell the plugin to require a secured communication channel (such as a SSL/TLS channel, provided by another SMTP extension of Jsmtpd, !TLSSwitcher. To tell it do so, use the property RequireSecuredChannel, and set it to true.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e480"></a>3.2.4.&nbsp;Example</h4></div></div></div><p>At the end, it should look like :</p><pre class="programlisting">&lt;smtpExtension name="auth" class="org.jsmtpd.plugins.smtpExtension.BasicSmtpAuth"&gt;
   &lt;propertyset name="MD5User" value="jfp,QtOI+LHbmX+q99q0h/ESkA=="/&gt;
   &lt;propertyset name="PlainUser" value="dummyUser,DummyPassword"/&gt;
   &lt;propertyset name="RequireSecuredChannel" value="true"/&gt;
&lt;/smtpExtension&gt;</pre></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e487"></a>Chapter&nbsp;5.&nbsp;Typical Use Case</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e490"></a>1.&nbsp;Antivirus/Antispam : ClamAV/Spamassassin</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e493"></a>1.1.&nbsp;Scenario</h3></div></div></div><p>In this example, we are going to setup a typical filter chain in Jsmtpd. First thing we want is to check mail for viruses. We want to drop mail containing viruses, while allowing the others to go throught the reste of the chain. Then, for the remaining mails, we want to see if they contain spam, but we don't want any of them to be dropped, just marked spam or not. We are going to use the ClamAV filter to check for viruses, and the spam assassin filter to check out for spam. We will also use the special filter ChainSucces to validate the chain even if the mail is detected as spam.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e498"></a>1.2.&nbsp;Summary</h3></div></div></div><p></p><div class="figure"><a name="d0e502"></a><p class="title"><b>Figure&nbsp;5.1.&nbsp;</b></p><div class="mediaobject"><img src="resources/filterExample2.jpg"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e507"></a>1.3.&nbsp;Filter Setup</h3></div></div></div><p>We are going to setup the three filter instances needed for the example :</p><div class="itemizedlist"><ul type="disc"><li><p>An instance of ClamAV filter, we will refer to it by its logical name (choose one, must be unique) : antivirus</p></li><li><p>An instance of SA filter, we will refer to it by its logical name (choose on, must be unique) : antispam</p></li><li><p>An instance of ChainSucces, we will refer to it by its logical name (choose on, must be unique) : chainvalid</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e522"></a>1.4.&nbsp;ClamAV Setup</h3></div></div></div><p>If you look at the plugin documentation of ClamAV filter, you will see that its associated class is "org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter ", and that it takes three parameters to setup the host, the port and the timeout. And the previous drawing and as we explained at the begining, we want to drop mail containing viruses automaticly. So, we will set the FailOnError parameter to true. Note that we could also don't care about this parameter, if we add a ChainFailure plugin to this plugin, or by leaving its false branch empty... But the mail would be silently droped. By setting FailOnError, the plugin will generate a error mail and break the chain to failure, causing the original mail to be droped.</p><p>Edit the etc/jsmtpf-plugin-config.xml file. Locate the element filtersetup. Add the following configuration to the filtersetup element, replacing the values to match your configuration :</p><pre class="programlisting">&lt;filterinit name="antivirus" class="org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter"&gt;
   &lt;propertyset name="ClamdHost" value="172.16.0.200"/&gt;
   &lt;propertyset name="ClamdPort" value="3310"/&gt;
   &lt;propertyset name="SocketTimeout" value="45"/&gt;
   &lt;propertyset name="FailOnError" value="true"/&gt;
&lt;filterinit&gt;</pre><p>Note that from now, this plugin is configured and we will refer to it later by its name parameter : antivirus.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e533"></a>1.5.&nbsp;SpamAssassin Setup</h3></div></div></div><p>The SAFilter documentations tells us that the class name to use is "org.jsmtpd.plugins.filters.SA.SAFilter", and the plugin takes three parameters.</p><p>Edit the etc/jsmtpf-plugin-config.xml file. Locate the element filtersetup. Add the following configuration to the filtersetup element, replacing the values to match your configuration :</p><pre class="programlisting">&lt;filterinit name="antispam" class="org.jsmtpd.plugins.filters.SA.SAFilter"&gt;
   &lt;propertyset name="SpamdHost" value="172.16.0.200"/&gt;
   &lt;propertyset name="SpamdPort" value="783"/&gt;
   &lt;propertyset name="SocketTimeout" value="45"/&gt;
&lt;/filterinit&gt;</pre><p>Note that from now, this plugin is configured and we will refer to it later by its name parameter : antispam.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e544"></a>1.6.&nbsp;ChainSucces Setup</h3></div></div></div><p>Nothing really hard here, as there is nothing to configure, juste get an instance named chainvalid from "org.jsmtpd.plugins.filters.builtin.ChainSucces"</p><p>Edit the etc/jsmtpf-plugin-config.xml file. Locate the element filtersetup. Add the following configuration to the filtersetup element, replacing the values to match your configuration :</p><pre class="programlisting">&lt;filterinit name="chainvalid" class="org.jsmtpd.plugins.filters.builtin.ChainSucces"&gt;
&lt;/filterinit&gt; </pre><p>Note that from now, this plugin is configured and we will refer to it later by its name parameter : chainvalid.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e555"></a>1.7.&nbsp;Build up the filter tree</h3></div></div></div><p>Now that our filters are loaded, we can use them in the filter tree. All we need to do is to assemble them just like in a construction game.</p><p>Edit the etc/jsmtpf-plugin-config.xml file. Locate the element bodyFilterTree. Your bodyFilterTree should look like :</p><pre class="programlisting">&lt;bodyFilterTree&gt;
  &lt;filter name="antivirus"&gt;
   &lt;true&gt;
    &lt;filter name="antispam"&gt;
     &lt;true&gt;
      &lt;filter name="chainvalid"&gt;
       &lt;true&gt;&lt;/true&gt;
       &lt;false&gt;&lt;/false&gt;
      &lt;/filter&gt;
     &lt;/true&gt;
     &lt;false&gt;
      &lt;filter name="chainvalid"&gt;
       &lt;true&gt;&lt;/true&gt;
       &lt;false&gt;&lt;/false&gt;
      &lt;/filter&gt;
     &lt;/false&gt;
    &lt;/filter&gt;
   &lt;/true&gt;
   &lt;false&gt;
   &lt;/false&gt;
  &lt;/filter&gt;
&lt;/bodyFilterTree&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e564"></a>1.8.&nbsp;Let's go</h3></div></div></div><p>Just fire up Jsmtpd using startup.sh or startup.bat depending on your platform.</p><p>If you have debug turned on, you should have something like :</p><pre class="programlisting">2005-03-14 20:39:07,580 INFO  Jsmtpd - Jsmtpd 0.2 experimental, Copyright (C) 2005 Jean-Francois Poux - jf.poux at laposte.net
2005-03-14 20:39:07,596 INFO  Jsmtpd - Jsmtpd comes with ABSOLUTELY NO WARRANTY;
2005-03-14 20:39:07,596 INFO  Jsmtpd - This is free software, and you are welcome to redistribute it under certain conditions;
2005-03-14 20:39:07,596 INFO  Jsmtpd - See the LICENCE file for details
2005-03-14 20:39:07,596 INFO  Jsmtpd - Server startup
2005-03-14 20:39:08,627 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.dnsServices.DNSJavaResolver, set DnsServers=172.16.0.200
2005-03-14 20:39:08,627 INFO  Jsmtpd - DNS Service plugin loaded : DNSJava resolver plugin for jsmptd
2005-03-14 20:39:08,627 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.acls.SimpleACL, set RelayedHosts=127.0.0.1,localhost,172.16.0.20,172.16.0.23
2005-03-14 20:39:08,643 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.acls.SimpleACL, set ValidUsers=*@localhost,*@mail.taldius.ath.cx
2005-03-14 20:39:08,643 INFO  Jsmtpd - ACL Service plugin loaded : Simple Acces Control List plugin for jsmtp
2005-03-14 20:39:08,643 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.deliveryServices.UnixMailboxWriter, set MailDir=mailboxes/
2005-03-14 20:39:08,658 INFO  Jsmtpd - Local Delivery Service plugin loaded : UnixMailboxWriter plugin for jsmtpd
2005-03-14 20:39:08,658 INFO  Jsmtpd - Remote Delivery Service plugin loaded : RemoteSmtpSender plugin fort jsmptd
2005-03-14 20:39:08,658 DEBUG Jsmtpd -  Trying to load [c]org.jsmtpd.plugins.filters.builtin.ChainSucces as [i]chainvalid
2005-03-14 20:39:08,658 DEBUG Jsmtpd -  Loaded [c]org.jsmtpd.plugins.filters.builtin.ChainSucces as [i]chainvalid
2005-03-14 20:39:08,658 DEBUG Jsmtpd -  Trying to load [c]org.jsmtpd.plugins.filters.SA.SAFilter as [i]antispam
2005-03-14 20:39:08,674 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.filters.SA.SAFilter, set SpamdHost=172.16.0.200
2005-03-14 20:39:08,674 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.filters.SA.SAFilter, set SpamdPort=783
2005-03-14 20:39:08,674 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.filters.SA.SAFilter, set SocketTimeout=45
2005-03-14 20:39:08,674 DEBUG Jsmtpd - Jsmtpd-SA SpamAssassin filter initialized
2005-03-14 20:39:08,674 DEBUG Jsmtpd -  Loaded [c]org.jsmtpd.plugins.filters.SA.SAFilter as [i]antispam
2005-03-14 20:39:08,674 DEBUG Jsmtpd -  Trying to load [c]org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter as [i]antivirus
2005-03-14 20:39:08,674 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter, set ClamdHost=172.16.0.200
2005-03-14 20:39:08,674 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter, set ClamdPort=3310
2005-03-14 20:39:08,674 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter, set SocketTimeout=45
2005-03-14 20:39:08,674 DEBUG Jsmtpd -   [c]:class org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter, set FailOnError=true
2005-03-14 20:39:08,674 DEBUG Jsmtpd - Jsmtpd-ClamAV antivirus filter initing
2005-03-14 20:39:09,689 DEBUG Jsmtpd - Jsmtpd-ClamAV antivirus filter initialized
2005-03-14 20:39:09,689 DEBUG Jsmtpd -  Loaded [c]org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter as [i]antivirus
2005-03-14 20:39:09,689 INFO  Jsmtpd - Plugin loaded : Chain succes: Filter tree chain succes
2005-03-14 20:39:09,689 INFO  Jsmtpd - Plugin loaded : Jsmtpd-SA SpamAssassin filter
2005-03-14 20:39:09,689 INFO  Jsmtpd - Plugin loaded : Jsmtpd-ClamAV antivirus filter
2005-03-14 20:39:09,689 DEBUG Jsmtpd - [tree]Loading filtree with root node [i]antivirus
2005-03-14 20:39:09,705 DEBUG Jsmtpd - [tree]adding antispam as true node to node Jsmtpd-ClamAV antivirus filter
2005-03-14 20:39:09,705 DEBUG Jsmtpd - [tree]adding chainvalid as true node to node Jsmtpd-SA SpamAssassin filter
2005-03-14 20:39:09,705 DEBUG Jsmtpd - [tree]adding chainvalid as false node to node Jsmtpd-SA SpamAssassin filter
2005-03-14 20:39:09,861 INFO  Jsmtpd - Listening for connections on port 25
2005-03-14 20:39:09,893 INFO  Jsmtpd - Delivery service started
2005-03-14 20:39:09,893 INFO  Jsmtpd - Server running</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e573"></a>1.9.&nbsp;Files</h3></div></div></div><p>Get the <a href="jsmtpd-plugin-config.xml" target="_top">jsmtpd-plugin-config.xml</a></p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e580"></a>Chapter&nbsp;6.&nbsp;Plugin Reference</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e583"></a>1.&nbsp;Input IP Filters</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e586"></a>1.1.&nbsp;Blacklist</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e589"></a>1.1.1.&nbsp;Description</h4></div></div></div><p>This plugin will check the IP address of a remote client against a list of black listed IP setted up by the admin, in the configuration file. Any match causes the connection to be dropped.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e594"></a>1.1.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is an input filter, it can only be used within an inputIPFilterChain element.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e599"></a>1.1.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>True, if the remote host is not known</p></li><li><p>False, if the remote host is black listed.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e609"></a>1.1.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.inputIPFilters.BlackList</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e614"></a>1.1.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>BlacklistedIP : String. Add the parameter as a black listed address.</p></li><li><p>BypassLocal : boolean. If set to true, local domains are not checked.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e624"></a>1.2.&nbsp;RBLFilter</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e627"></a>1.2.1.&nbsp;Description</h4></div></div></div><p>The RBL filter connects to a list of Real Time Black List servers and checks the ip address of a remote host against them. If the host is known, the connection is dropped.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e632"></a>1.2.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is an input filter, it can only be used within an inputIPFilterChain element.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e637"></a>1.2.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>True, if the host is not know</p></li><li><p>False, if the host is known.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e647"></a>1.2.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.inputIPFilters.RBLFilter</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e652"></a>1.2.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>RBLServer : String. Hostname of a RBL service to query.</p></li><li><p>BypassLocal : Boolean. Local domains skip the filter if set to true.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e662"></a>1.2.6.&nbsp;Notes</h4></div></div></div><p>A RBL check is in fact a DNS query, answered by specialized servers. As for any DNS query, this process can be slow. To speed up the process, use the BypassLocal property and use a DNS server that is able to cache requests.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e667"></a>2.&nbsp;Body Filters</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e670"></a>2.1.&nbsp;ClamAV, Clam antivirus filter</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e673"></a>2.1.1.&nbsp;Description</h4></div></div></div><p>This plugin is a filter that connects to a clamd (ClamAV) daemon, passes it the content of mail for checking, and read the response. The mail is not altered throught this plugin.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e678"></a>2.1.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is a body filter, it can only be used with in bodyFilterTree configuration element. It will scan the body of the mail.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e683"></a>2.1.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>True, if the mail does not contains viruses</p></li><li><p>False, if the mail contains viruses</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e693"></a>2.1.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.filters.ClamAV.ClamAVFilter</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e698"></a>2.1.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>ClamdHost</strong></span> : the ip of the server running clamAV daemon</p></li><li><p><span class="bold"><strong>ClamdPort</strong></span> : the tcp port that the clamAV deamon listens on (ranges 1-65535)</p></li><li><p><span class="bold"><strong>SocketTimeout</strong></span> : the socket timeout in seconds, if no response can be obtained within this time, the connection is closed and the plugins returns false</p></li><li><p><span class="bold"><strong>FailOnError</strong></span> : boolean, default false. If true, a positive virus detection will generate an error email and break the chain in error state (mail will be droped).</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e722"></a>2.1.6.&nbsp;See Also</h4></div></div></div><p>Clam AntiVirus homepage, <a href="http://www.clamav.net/" target="_top">http://www.clamav.net/</a></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e729"></a>2.2.&nbsp;SA, Spamassassin anti spam filter</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e732"></a>2.2.1.&nbsp;Description</h4></div></div></div><p>This plugin is a filter that connects to a spamd (spamassassin) daemon, passes it the content of mail for checking, and read the response. The mail is altered by the spamd daemon.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e737"></a>2.2.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is a body filter, it can only be used with in bodyFilterTree configuration element. It will scan the body of the mail.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e742"></a>2.2.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>True, if the mail does not contains spam</p></li><li><p>False, if the mail contains spam</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e752"></a>2.2.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.filters.SA.SAFilter</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e757"></a>2.2.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>SpamdHost</strong></span> : the ip of the server running spamd daemon</p></li><li><p><span class="bold"><strong>SpamdPort</strong></span> : the tcp port that the spamd deamon listens on (ranges 1-65535)</p></li><li><p><span class="bold"><strong>SocketTimeout</strong></span> : the socket timeout in seconds, if no response can be obtained within this time, the connection is closed and the plugins returns false</p></li><li><p><span class="bold"><strong>SkipIfSizeMore</strong></span> : spam are usually small sized mails, if a mails exceeds this size, it won't be analyzed by the spamd daemon, saving ressources.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e781"></a>2.2.6.&nbsp;See Also</h4></div></div></div><p>SpamAssassin homepage, <a href="http://spamassassin.apache.org/" target="_top">http://spamassassin.apache.org/</a></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e788"></a>2.3.&nbsp;Jasen anti spam filter</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e791"></a>2.3.1.&nbsp;Description</h4></div></div></div><p>This plugin is a filter that runs a Jasen Engine, passes it the content of mail for checking, and read the response. The mail is not altered.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e796"></a>2.3.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is a body filter, it can only be used with in bodyFilterTree configuration element. It will scan the body of the mail.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e801"></a>2.3.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>True, if the mail does not contains spam</p></li><li><p>False, if the mail contains spam</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e811"></a>2.3.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.filters.Jasen.JasenSpamFilter</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e816"></a>2.3.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>FailOnError</strong></span>, boolean. Default : false. If set to true, when a spam detection occurs, a message is sent back to sender telling why it rejected the mail, and break the chain in a failure state</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e825"></a>2.3.6.&nbsp;See Also</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>plugin/filters/Jasen/jasen-config/ directory to configure the Jasen Engine, refer to the documentation of Jasen</p></li><li><p>Jasen homepage <a href="http://www.jasen.org/" target="_top">http://www.jasen.org/</a></p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e837"></a>2.4.&nbsp;RcptMatcher Filter</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e840"></a>2.4.1.&nbsp;Description</h4></div></div></div><p>This plugin examines the recipients of a mail against a list that you can configure. The match rule can be match ALL or match ONE.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e845"></a>2.4.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is a body filter, it can only be used with in bodyFilterTree configuration element.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e850"></a>2.4.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>True, if the rule is matched</p></li><li><p>False, otherwise</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e860"></a>2.4.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.filters.builtin.RcptMatcher</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e865"></a>2.4.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>FailOnError</strong></span>, boolean. Default : false. If set to true, a false response is transformed to a filter tree break in state of failure</p></li><li><p><span class="bold"><strong>validateOnSucces</strong></span>, boolean. Default : false. If set to true, a True response is transformed to a filter tree break in state of success</p></li><li><p><span class="bold"><strong>orOperator</strong></span>, boolean. Default : false. By default, all recipients must be match. Set tot true to turn to a orOperator instead</p></li><li><p><span class="bold"><strong>Rcpt</strong></span>, String. An email address to match</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e889"></a>2.5.&nbsp;RcptRewrite Filter</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e892"></a>2.5.1.&nbsp;Description</h4></div></div></div><p>This plugin can change the recipient of a mail. It is used do define mail aliases, or catch all accounts.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e897"></a>2.5.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is a body filter, it can only be used with in bodyFilterTree configuration element.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e902"></a>2.5.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>This filter always returns true.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e909"></a>2.5.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.filters.builtin.RcptRewrite</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e914"></a>2.5.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>CatchAll</strong></span>, String. format : Domain adress, mailbox address. Example : *@yourdomain.com,smith@yourdomain.com, will deliver all mail that have not mailboxes on domain yourdomain.com to smith@yourdomain.com. The recipient might be local or remote. You can set this property several times to add multiples catchall.</p></li><li><p><span class="bold"><strong>Rewrite</strong></span>, String. format : adress to match,targeted address. Example : john@yourdomain.com,smith@yourdomain.com. The target might be local or remote. You can set this property several times to add multiples rewrites.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e928"></a>2.6.&nbsp;LdapBodyRewriter</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e931"></a>2.6.1.&nbsp;Description</h4></div></div></div><p>This plugin will check the aliases of your domain(s) against a ldap directory to change recipients to their real accounts.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e936"></a>2.6.2.&nbsp;Filter Type</h4></div></div></div><p>This filter is a body filter, it can only be used with in bodyFilterTree configuration element.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e941"></a>2.6.3.&nbsp;Responses</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>This filter always returns true.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e948"></a>2.6.4.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.filters.ldap.LdapBodyRewriter</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e953"></a>2.6.5.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>ldapAdminLogin</strong></span>:  Your ldap connection chain, example : cn=admin,dc=jsmtpd,dc=org</p></li><li><p><span class="bold"><strong>ldapAdminPassword</strong></span>: your ldap admin password</p></li><li><p><span class="bold"><strong>ldapUrl</strong></span>: your ldap server, example : ldap://192.168.10.1/</p></li><li><p><span class="bold"><strong>ldapUserProvider</strong></span>: Where are your users ? example : ou=people,dc=jsmtpd,dc=org</p></li><li><p><span class="bold"><strong>ldapUserAliasAttribute</strong></span>: name of multi properties holding the aliases. it depends on your schema. Example : rfc822MailAlias</p></li><li><p><span class="bold"><strong>ldapUserLogin</strong></span>: name of the user attribute holding the real name of user, example uid in a posix schema.</p></li></ul></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e987"></a>3.&nbsp;Acces Control List</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e990"></a>3.1.&nbsp;SimpleACL, config file based</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e993"></a>3.1.1.&nbsp;Description</h4></div></div></div><p>This plugin is an ACL provider for the Jsmtpd engine, based on config file. It tells the engine who can acces the server.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e998"></a>3.1.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.acls.SimpleACL</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1003"></a>3.1.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>RelayedHosts</strong></span> : A list of IP addresses separated by comma. The server will relay theses hosts. Always keep 127.0.0.1 and localhost, or the error mails will be droped. You can use a netmask (decimal dot format) to specify multiple hosts, by example 172.16.0.0/255.255.0.0.</p></li><li><p><span class="bold"><strong>ValidUsers</strong></span> : A list of users@domain separated by comma. Theses users will be considered as local, and the engine will use the local delivery plugin to send the mail. You can use * as wildcard to mean any user. Keep *@localhost</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1017"></a>3.2.&nbsp;LdapACL, ldap directory based</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1020"></a>3.2.1.&nbsp;Description</h4></div></div></div><p>This plugin is an ACL provider for the Jsmtpd engine, based on queries against a ldap directory server. There are two things this plugin do : get the user names/aliases in the directory to determine if recipients are local, and gather informations of networks to relay. In your directory, you should have a ou (Organisation Unit) for users, and another for networks to be relayed.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1025"></a>3.2.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.acls.LdapACL</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1030"></a>3.2.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>ldapAdminLogin</strong></span> : Your ldap connection chain, example : cn=admin,dc=jsmtpd,dc=org</p></li><li><p><span class="bold"><strong>ldapAdminPassword</strong></span> : Your ldap admin password</p></li><li><p><span class="bold"><strong>ldapUrl</strong></span> : your ldap server, example : ldap://192.168.10.1/</p></li><li><p><span class="bold"><strong>ldapUserProvider</strong></span> : Node where users are, example ou=people,dc=jsmtpd,dc=org</p></li><li><p><span class="bold"><strong>ldapUserAliasAttribute</strong></span> : user mail alias attribute, might be multiple, example rfc822MailAlias</p></li><li><p><span class="bold"><strong>ldapUserLogin</strong></span> : name of attribute holding short username (login). Uid in case of posixAccoutn schema</p></li><li><p><span class="bold"><strong>ldapUserPassword</strong></span> : name of attribute holdinguser password, example : userPassword</p></li><li><p><span class="bold"><strong>ldapNetworkProvider</strong></span> : node where networks are stored, example: ou=networks,dc=jsmtpd,dc=org</p></li><li><p><span class="bold"><strong>ldapNetworkClass</strong></span> : class of network objects, example : ipNetwork</p></li><li><p><span class="bold"><strong>ldapNetworkAddressAttribute</strong></span> : name of attribute holdinguser ipv4 address</p></li><li><p><span class="bold"><strong>ldapNetworkMaskAttribute</strong></span> :name of attribute holding your ipv4 mask, associated with an address</p></li></ul></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1089"></a>4.&nbsp;DNS Service</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1092"></a>4.1.&nbsp;DNSJava resolver</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1095"></a>4.1.1.&nbsp;Description</h4></div></div></div><p>This plugin is an DNS provider for the Jsmtpd Engine. It is based on the DNSJava library.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1100"></a>4.1.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.dnsServices.DNSJavaResolver</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1105"></a>4.1.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>DnsServers</strong></span> : a list of DNS servers to query, separated with comma.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1114"></a>4.1.4.&nbsp;See also</h4></div></div></div><p>DNSJava homepage, <a href="http://www.xbill.org/dnsjava/" target="_top">http://www.xbill.org/dnsjava/</a></p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1121"></a>5.&nbsp;DeliveryServices</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1124"></a>5.1.&nbsp;Mailbox Writer</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1127"></a>5.1.1.&nbsp;Description</h4></div></div></div><p>This plugin is a delivery service for Jsmtpd. It writes the mails to a mbox file, according to the user's name. The file is locked to ensure proper operations.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1132"></a>5.1.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.deliveryServices.UnixMailboxWriter</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1137"></a>5.1.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>MailDir</strong></span> : A path on disk where to store the mails. The user running Jsmtpd must have read/write/execute rights to this directory</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1146"></a>5.2.&nbsp;RemoteSmtpSender</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1149"></a>5.2.1.&nbsp;Description</h4></div></div></div><p>This plugin is a delivery service for Jsmtpd. It connects to a remote smtp server for each rcpt and tries to deliver the mail.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1154"></a>5.2.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.deliveryServices.RemoteSmtpSender</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1159"></a>5.2.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>ConnectionTimeout</strong></span> : The connection will be dropped after this amout of time of inactivity (in seconds)</p></li></ul></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1168"></a>6.&nbsp;SMTP Extensions</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1171"></a>6.1.&nbsp;TLS Switcher</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1174"></a>6.1.1.&nbsp;Description</h4></div></div></div><p>This smtp extension provides support for the starttls command (switch channel to SSL)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1179"></a>6.1.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.smtpExtension.TLSSwitcher</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1184"></a>6.1.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>keystoreName</strong></span> : name of the keystore file to use, has to be in classpath (etc/ by example).</p></li><li><p><span class="bold"><strong>keystorePassword</strong></span> : your keystore password</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1198"></a>6.2.&nbsp;Basic SMTP Authentication</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1201"></a>6.2.1.&nbsp;Description</h4></div></div></div><p>This plugin adds support for PLAN and LOGIN authentication method. User/passwords are stored in the xml config file</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1206"></a>6.2.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.smtpExtension.BasicSmtpAuth</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1211"></a>6.2.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>plainUser</strong></span> : add the user password, example : "smith,secret"</p></li><li><p><span class="bold"><strong>md5User</strong></span> : add the user password, example : "smith,md5password"</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1225"></a>6.3.&nbsp;LDAP SMTP Authentication</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1228"></a>6.3.1.&nbsp;Description</h4></div></div></div><p>This plugin adds support for PLAN and LOGIN authentication method. User/passwords are stored in ldap server.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1233"></a>6.3.2.&nbsp;Class Name</h4></div></div></div><p>org.jsmtpd.plugins.smtpExtension.LdapAuthenticator</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1238"></a>6.3.3.&nbsp;Parameters</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>ldapAdminLogin</strong></span> : ldap admin connection chain, example : cn=admin,dc=jsmtpd,dc=org</p></li><li><p><span class="bold"><strong>ldapAdminPassword</strong></span> : your ldap admin password</p></li><li><p><span class="bold"><strong>ldapUrl</strong></span> : your ldap server, example ldap://192.168.10.1/</p></li><li><p><span class="bold"><strong>ldapUserProvider</strong></span> : Where your users are stored, example ou=people,dc=jsmtpd,dc=org</p></li><li><p><span class="bold"><strong>ldapUserLogin</strong></span> : Attribute of user objects holding login uid</p></li><li><p><span class="bold"><strong>ldapUserPassword</strong></span> : Attribute of user objects holding password (md5 or crypt supported)</p></li></ul></div></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1272"></a>Chapter&nbsp;7.&nbsp;FAQ</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1275"></a>1.&nbsp;Why can't I check the incoming mails ?</h2></div></div></div><p>Jsmtpd's job is to receive and send mails. When it receives local mails, they are stored on disk, or whatever persistant media. To check your mail, you will need another service, likely a POP or IMAP daemon. Jsmtpd might one day embed a small service like theses. For now, you can use any pop3/imap daemon able to work with mbox files. Under win32 platforms, I just don't know, I've heard that uw pop would work on it.</p></div></div></div></body></html>