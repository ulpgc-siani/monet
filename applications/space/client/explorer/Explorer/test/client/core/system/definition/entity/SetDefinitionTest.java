package client.core.system.definition.entity;

import client.ApplicationTestCase;
import client.core.model.definition.views.ViewDefinition;
import client.services.http.HttpInstance;
import client.services.http.builders.definition.entity.CollectionDefinitionBuilder;
import client.services.http.builders.definition.entity.EntityDefinitionBuilder;
import com.google.gwt.core.client.JsonUtils;
import org.junit.Test;

public class SetDefinitionTest extends ApplicationTestCase {

	private static final String DEFINITION = "{\"code\":\"myu5yzg\",\"name\":\"org.monet.explorerintegration.CollectionSample\",\"type\":\"collection\",\"label\":\"CollectionSample\",\"views\":{\"totalCount\":2,\"items\":[{\"code\":\"m8ppx_a\",\"type\":\"set\",\"label\":\"Items\",\"default\":false,\"show\":{\"items\":{}}},{\"code\":\"mcmkpow\",\"type\":\"set\",\"label\":\"Índice\",\"default\":false,\"show\":{\"index\":{\"sortBy\":\"mwkjusw\",\"withView\":\"myqq8ia\"}}}]}}";
	private static final String COLLECTION_WITH_ADD = "{\"code\":\"m5_p1gg\",\"name\":\"micv.formularios.ICColeccion\",\"type\":\"collection\",\"label\":\"Tipos de incidencia\",\"views\":{\"totalCount\":6,\"items\":[{\"code\":\"ml4jusq\",\"name\":\"SituacionProfesional\",\"type\":\"set\",\"label\":\"Situación profesional\",\"default\":false,\"design\":\"DOCUMENT\",\"show\":{\"index\":{\"sortBy\":\"mpor5kw\",\"mode\":\"ASC\",\"withView\":\"mtuxfkg\"}},\"select\":{\"nodes\":{\"totalCount\":1,\"items\":[{\"value\":\"micv.formularios.Ic010010\"}]}}},{\"code\":\"mjhkm4q\",\"name\":\"FormacionAcademicaRecibida\",\"type\":\"set\",\"label\":\"Formación academica recibida\",\"default\":false,\"design\":\"DOCUMENT\",\"show\":{\"index\":{\"sortBy\":\"mpor5kw\",\"mode\":\"ASC\",\"withView\":\"mtuxfkg\"}},\"select\":{\"nodes\":{\"totalCount\":5,\"items\":[{\"value\":\"micv.formularios.Ic020060\"},{\"value\":\"micv.formularios.Ic020020\"},{\"value\":\"micv.formularios.Ic020010020\"},{\"value\":\"micv.formularios.Ic020010010\"},{\"value\":\"micv.formularios.Ic020050\"}]}}},{\"code\":\"mxxspta\",\"name\":\"ActividadDocente\",\"type\":\"set\",\"label\":\"Actividad docente\",\"default\":false,\"design\":\"DOCUMENT\",\"show\":{\"index\":{\"sortBy\":\"mpor5kw\",\"mode\":\"ASC\",\"withView\":\"mtuxfkg\"}},\"select\":{\"nodes\":{\"totalCount\":10,\"items\":[{\"value\":\"micv.formularios.Ic030060\"},{\"value\":\"micv.formularios.Ic040140\"},{\"value\":\"micv.formularios.Ic030090\"},{\"value\":\"micv.formularios.Ic030040\"},{\"value\":\"micv.formularios.Ic030080\"},{\"value\":\"micv.formularios.Ic030050\"},{\"value\":\"micv.formularios.Ic030010\"},{\"value\":\"micv.formularios.Ic030070\"},{\"value\":\"micv.formularios.Ic060030080\"},{\"value\":\"micv.formularios.Ic030020\"}]}}},{\"code\":\"mtujrhq\",\"name\":\"ExperienciaCientificaTecnologica\",\"type\":\"set\",\"label\":\"Experiencia científica y tecnológica\",\"default\":false,\"design\":\"DOCUMENT\",\"show\":{\"index\":{\"sortBy\":\"mpor5kw\",\"mode\":\"ASC\",\"withView\":\"mtuxfkg\"}},\"select\":{\"nodes\":{\"totalCount\":4,\"items\":[{\"value\":\"micv.formularios.Ic050010\"},{\"value\":\"micv.formularios.Ic050020030\"},{\"value\":\"micv.formularios.Ic050030010\"},{\"value\":\"micv.formularios.Ic050020010\"}]}}},{\"code\":\"mgkffma\",\"name\":\"ActividadCientificaTecnologica\",\"type\":\"set\",\"label\":\"Actividad científica y tecnológica\",\"default\":false,\"design\":\"DOCUMENT\",\"show\":{\"index\":{\"sortBy\":\"mpor5kw\",\"mode\":\"ASC\",\"withView\":\"mtuxfkg\"}},\"select\":{\"nodes\":{\"totalCount\":17,\"items\":[{\"value\":\"micv.formularios.Ic060010020\"},{\"value\":\"micv.formularios.Ic060020040\"},{\"value\":\"micv.formularios.Ic060010050\"},{\"value\":\"micv.formularios.Ic060020020\"},{\"value\":\"micv.formularios.Ic060020030\"},{\"value\":\"micv.formularios.Ic060010010\"},{\"value\":\"micv.formularios.Ic060030060\"},{\"value\":\"micv.formularios.Ic060030090\"},{\"value\":\"micv.formularios.Ic060020010\"},{\"value\":\"micv.formularios.Ic060030070\"},{\"value\":\"micv.formularios.Ic060030050\"},{\"value\":\"micv.formularios.Ic060030040\"},{\"value\":\"micv.formularios.Ic060030100\"},{\"value\":\"micv.formularios.Ic060030020\"},{\"value\":\"micv.formularios.Ic060030010\"},{\"value\":\"micv.formularios.Ic060020050\"},{\"value\":\"micv.formularios.Ic060020060\"}]}}},{\"code\":\"me_6ygg\",\"name\":\"ActividadCampoSanidad\",\"type\":\"set\",\"label\":\"Actividad en el campo de la sanidad\",\"default\":false,\"design\":\"DOCUMENT\",\"show\":{\"index\":{\"sortBy\":\"mpor5kw\",\"mode\":\"ASC\",\"withView\":\"mtuxfkg\"}},\"select\":{\"nodes\":{\"totalCount\":8,\"items\":[{\"value\":\"micv.formularios.Ic040010\"},{\"value\":\"micv.formularios.Ic020030\"},{\"value\":\"micv.formularios.Ic040090\"},{\"value\":\"micv.formularios.Ic040130\"},{\"value\":\"micv.formularios.Ic040100\"},{\"value\":\"micv.formularios.Ic040080\"},{\"value\":\"micv.formularios.Ic040110\"},{\"value\":\"micv.formularios.Ic040120\"}]}}}]},\"add\":{\"node\":{\"totalCount\":46,\"items\":[{\"value\":\"micv.formularios.Ic010010\"},{\"value\":\"micv.formularios.Ic020010010\"},{\"value\":\"micv.formularios.Ic020010020\"},{\"value\":\"micv.formularios.Ic020030\"},{\"value\":\"micv.formularios.Ic020020\"},{\"value\":\"micv.formularios.Ic020050\"},{\"value\":\"micv.formularios.Ic030060\"},{\"value\":\"micv.formularios.Ic040090\"},{\"value\":\"micv.formularios.Ic040130\"},{\"value\":\"micv.formularios.Ic020060\"},{\"value\":\"micv.formularios.Ic040010\"},{\"value\":\"micv.formularios.Ic030010\"},{\"value\":\"micv.formularios.Ic030020\"},{\"value\":\"micv.formularios.Ic030040\"},{\"value\":\"micv.formularios.Ic030050\"},{\"value\":\"micv.formularios.Ic040080\"},{\"value\":\"micv.formularios.Ic030080\"},{\"value\":\"micv.formularios.Ic030090\"},{\"value\":\"micv.formularios.Ic030100\"},{\"value\":\"micv.formularios.Ic030070\"},{\"value\":\"micv.formularios.Ic040100\"},{\"value\":\"micv.formularios.Ic040140\"},{\"value\":\"micv.formularios.Ic060020020\"},{\"value\":\"micv.formularios.Ic060020030\"},{\"value\":\"micv.formularios.Ic060020040\"},{\"value\":\"micv.formularios.Ic060020060\"},{\"value\":\"micv.formularios.Ic060030060\"},{\"value\":\"micv.formularios.Ic060010050\"},{\"value\":\"micv.formularios.Ic050010\"},{\"value\":\"micv.formularios.Ic050020010\"},{\"value\":\"micv.formularios.Ic040110\"},{\"value\":\"micv.formularios.Ic040120\"},{\"value\":\"micv.formularios.Ic060010010\"},{\"value\":\"micv.formularios.Ic060010020\"},{\"value\":\"micv.formularios.Ic050020030\"},{\"value\":\"micv.formularios.Ic050030010\"},{\"value\":\"micv.formularios.Ic060020010\"},{\"value\":\"micv.formularios.Ic060030020\"},{\"value\":\"micv.formularios.Ic060030040\"},{\"value\":\"micv.formularios.Ic060020050\"},{\"value\":\"micv.formularios.Ic060030090\"},{\"value\":\"micv.formularios.Ic060030070\"},{\"value\":\"micv.formularios.Ic060030100\"},{\"value\":\"micv.formularios.Ic060030050\"},{\"value\":\"micv.formularios.Ic060030080\"},{\"value\":\"micv.formularios.Ic060030010\"}]}}}";

	@Test
	public void testLoadDefinition() {
		EntityDefinitionBuilder builder = new EntityDefinitionBuilder<>();
		builder.build((HttpInstance) JsonUtils.safeEval(DEFINITION));
	}

	@Test
	public void testLoadAdd() {
		CollectionDefinitionBuilder builder = new CollectionDefinitionBuilder();
		client.core.model.definition.entity.CollectionDefinition definition = builder.build((HttpInstance) JsonUtils.safeEval(COLLECTION_WITH_ADD));

		assertNotNull(definition.getAdd());
		assertEquals(46, definition.getAdd().getNode().size());
		assertEquals(ViewDefinition.Design.DOCUMENT, definition.getViews().get(0).getDesign());
	}
}