package client.core.adapters;

import client.ApplicationTestCase;
import client.core.model.Node;
import client.core.model.definition.entity.NodeDefinition;
import client.services.http.HttpInstance;
import client.services.http.builders.NodeBuilder;
import client.services.http.builders.definition.entity.NodeDefinitionBuilder;
import com.google.gwt.core.client.JsonUtils;
import org.junit.Test;

public class NodeDefinitionAdapterTest extends ApplicationTestCase {

    @Test
    public void testCompositeWithCompositeField() {
        Node node = new NodeBuilder<>().build((HttpInstance) JsonUtils.safeEval("{\"id\":\"18\",\"label\":\"\",\"type\":\"form\",\"description\":\"Puede indicar la situación laboral/profesional tanto en el momento de escribir el CV como en situaciones anteriores\",\"definition\":{\"code\":\"ic.010.010\",\"name\":\"micv.formularios.Ic010010\",\"type\":\"form\"},\"owner\":{\"id\":\"9\",\"type\":\"collection\",\"label\":\"Tipos de incidencia\",\"definition\":{\"code\":\"m5_p1gg\",\"name\":\"micv.formularios.ICColeccion\",\"type\":\"collection\"}},\"ancestors\":{\"totalCount\":3,\"items\":[{\"id\":\"3\",\"type\":\"collection\",\"label\":\"Curriculums\",\"definition\":{\"code\":\"currimulums\",\"name\":\"micv.Curriculums\",\"type\":\"collection\"}},{\"id\":\"7\",\"type\":\"container\",\"label\":\"Curriculum Vitae\",\"definition\":{\"code\":\"mpnu5yw\",\"name\":\"micv.CvInvestigador\",\"type\":\"container\"}},{\"id\":\"9\",\"type\":\"collection\",\"label\":\"Tipos de incidencia\",\"definition\":{\"code\":\"m5_p1gg\",\"name\":\"micv.formularios.ICColeccion\",\"type\":\"collection\"}}]},\"fields\":{\"totalCount\":9,\"items\":[{\"code\":\"F026\",\"type\":\"memo\",\"label\":\"Interés para la docencia y/o investigación\",\"value\":\"\"},{\"code\":\"moagd5q\",\"type\":\"file\",\"multiple\":true,\"label\":\"Documentos adjuntos\",\"value\":[]},{\"code\":\"F029\",\"type\":\"composite\",\"label\":\"Situación laboral\",\"value\":{\"fields\":[{\"code\":\"F030\",\"type\":\"select\",\"label\":\"Estado\",\"value\":{\"value\":\"001\",\"label\":\"Actual\"}}]}},{\"code\":\"F007\",\"type\":\"composite\",\"label\":\"Dedicación\",\"value\":{\"fields\":[{\"code\":\"F008\",\"type\":\"text\",\"label\":\"Categoría/puesto o cargo\",\"value\":\"\"},{\"code\":\"F029n\",\"type\":\"text\",\"label\":\"Códigos Unesco\",\"value\":\"\"},{\"code\":\"F028\",\"type\":\"text\",\"multiple\":true,\"label\":\"Líneas de investigación\",\"value\":[]},{\"code\":\"F011\",\"type\":\"memo\",\"label\":\"Dedicación profesional\",\"value\":\"\"},{\"code\":\"F009\",\"type\":\"select\",\"label\":\"Modalidad del contrato\",\"value\":{\"value\":\"350\",\"label\":\"Funcionario/a\"}},{\"code\":\"F010\",\"type\":\"select\",\"label\":\"Tipo de dedicación\",\"value\":{\"value\":\"020\",\"label\":\"Tiempo completo\"}},{\"code\":\"F012\",\"type\":\"select\",\"multiple\":true,\"label\":\"Palabras clave dedicación\",\"value\":[]}]}},{\"code\":\"F001\",\"type\":\"composite\",\"label\":\"Tipo de actividad\",\"value\":{\"fields\":[{\"code\":\"F002\",\"type\":\"boolean\",\"label\":\"Es gestión docente\",\"value\":false}]}},{\"code\":\"F013\",\"type\":\"composite\",\"label\":\"Especialidad\",\"value\":{\"fields\":[{\"code\":\"F025\",\"type\":\"composite\",\"label\":\"Área de especialización\",\"value\":{\"fields\":[{\"code\":\"F014\",\"type\":\"select\",\"multiple\":true,\"label\":\"Área de especialización primaria\",\"value\":[]},{\"code\":\"F015\",\"type\":\"select\",\"multiple\":true,\"label\":\"Área de especialización secundaria\",\"value\":[]},{\"code\":\"F016\",\"type\":\"select\",\"multiple\":true,\"label\":\"Área de especialización terciaria\",\"value\":[]}]}}]}},{\"code\":\"F017\",\"type\":\"composite\",\"label\":\"Periodo\",\"value\":{\"fields\":[{\"code\":\"F018\",\"type\":\"date\",\"label\":\"Fecha de inicio\",\"value\":-1},{\"code\":\"F019\",\"type\":\"date\",\"label\":\"Fecha de finalización\",\"value\":-1}]}},{\"code\":\"F003\",\"type\":\"composite\",\"label\":\"Entidad\",\"value\":{\"fields\":[{\"code\":\"F020\",\"type\":\"text\",\"label\":\"Dirección postal\",\"value\":\"\"},{\"code\":\"F021\",\"type\":\"text\",\"label\":\"Teléfono\",\"value\":\"\"},{\"code\":\"F022\",\"type\":\"text\",\"label\":\"Fax\",\"value\":\"\"},{\"code\":\"F023\",\"type\":\"text\",\"multiple\":true,\"label\":\"Correo electrónico\",\"value\":[]},{\"code\":\"F004\",\"type\":\"link\",\"label\":\"Nombre de la entidad\",\"value\":{\"id\":\"\",\"label\":\"\",\"index\":{\"id\":\"mu_sfca\"}}},{\"code\":\"F005\",\"type\":\"link\",\"label\":\"Facultad, escuela, etc.\",\"value\":{\"id\":\"\",\"label\":\"\",\"index\":{\"id\":\"mu_sfca\"}}},{\"code\":\"F006\",\"type\":\"link\",\"label\":\"Departamento, servicio, etc.\",\"value\":{\"id\":\"\",\"label\":\"\",\"index\":{\"id\":\"mu_sfca\"}}},{\"code\":\"F024\",\"type\":\"select\",\"label\":\"Lugar de trabajo\",\"value\":{\"value\":\"\",\"label\":\"\"}}]}},{\"code\":\"F027\",\"type\":\"select\",\"label\":\"Tipo de actividad de gestión\",\"value\":{\"value\":\"\",\"label\":\"\"}}]}}"));
        NodeDefinition definition = new NodeDefinitionBuilder().build((HttpInstance) JsonUtils.safeEval("{\"code\":\"ic.010.010\",\"name\":\"micv.formularios.Ic010010\",\"type\":\"form\",\"label\":\"Cargo y actividad desempeñada\",\"description\":\"Puede indicar la situación laboral/profesional tanto en el momento de escribir el CV como en situaciones anteriores\",\"views\":{\"totalCount\":1,\"items\":[{\"code\":\"mfybpba\",\"name\":\"Vista\",\"type\":\"form\",\"label\":\"Nuevos\",\"default\":false,\"show\":{\"fields\":{\"totalCount\":9,\"items\":[{\"value\":\"documentosAdjuntos\",\"definition\":\"Icpadre\"},{\"value\":\"Fi029\",\"definition\":\"ic.010.010\"},{\"value\":\"Fi007\",\"definition\":\"ic.010.010\"},{\"value\":\"Fi001\",\"definition\":\"ic.010.010\"},{\"value\":\"Fi013\",\"definition\":\"ic.010.010\"},{\"value\":\"Fi017\",\"definition\":\"ic.010.010\"},{\"value\":\"Fi003\",\"definition\":\"ic.010.010\"},{\"value\":\"Fi026\",\"definition\":\"ic.010.010\"},{\"value\":\"Fi027\",\"definition\":\"ic.010.010\"}]}}}]},\"fields\":{\"totalCount\":9,\"items\":[{\"code\":\"F026\",\"name\":\"Fi026\",\"label\":\"Interés para la docencia y/o investigación\",\"type\":\"memo\",\"displays\":{\"totalCount\":0,\"items\":[]}},{\"code\":\"moagd5q\",\"name\":\"documentosAdjuntos\",\"label\":\"Documentos adjuntos\",\"type\":\"file\",\"displays\":{\"totalCount\":0,\"items\":[]}},{\"code\":\"F029\",\"name\":\"Fi029\",\"label\":\"Situación laboral\",\"type\":\"composite\",\"displays\":{\"totalCount\":0,\"items\":[]},\"extensible\":false,\"conditional\":false,\"fields\":{\"totalCount\":1,\"items\":[{\"code\":\"F030\",\"name\":\"Fi030\",\"label\":\"Estado\",\"type\":\"select\",\"required\":true,\"displays\":{\"totalCount\":0,\"items\":[]},\"terms\":{\"totalCount\":2,\"items\":[{\"key\":\"001\",\"label\":\"Actual\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"002\",\"label\":\"Anterior\",\"terms\":{\"totalCount\":0,\"items\":[]}}]},\"allowOther\":false,\"allowKey\":false,\"select\":{\"embedded\":true}}]}},{\"code\":\"F007\",\"name\":\"Fi007\",\"label\":\"Dedicación\",\"type\":\"composite\",\"displays\":{\"totalCount\":0,\"items\":[]},\"extensible\":false,\"conditional\":false,\"fields\":{\"totalCount\":7,\"items\":[{\"code\":\"F008\",\"name\":\"Fi008\",\"label\":\"Categoría/puesto o cargo\",\"type\":\"text\",\"required\":true,\"displays\":{\"totalCount\":0,\"items\":[]},\"patterns\":[]},{\"code\":\"F029n\",\"name\":\"Fi029n\",\"label\":\"Códigos Unesco\",\"type\":\"text\",\"required\":true,\"displays\":{\"totalCount\":0,\"items\":[]},\"patterns\":[]},{\"code\":\"F028\",\"name\":\"Fi028\",\"label\":\"Líneas de investigación\",\"type\":\"text\",\"required\":true,\"displays\":{\"totalCount\":0,\"items\":[]},\"patterns\":[]},{\"code\":\"F011\",\"name\":\"Fi011\",\"label\":\"Dedicación profesional\",\"type\":\"memo\",\"displays\":{\"totalCount\":0,\"items\":[]}},{\"code\":\"F009\",\"name\":\"Fi009\",\"label\":\"Modalidad del contrato\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"terms\":{\"totalCount\":7,\"items\":[{\"key\":\"350\",\"label\":\"Funcionario/a\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"440\",\"label\":\"Interino/a\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"040\",\"label\":\"Becario/a (pre o posdoctoral, otros)\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"260\",\"label\":\"Emérito/a\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"300\",\"label\":\"Estatuario/a\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"160\",\"label\":\"Contrato laboral indefinido\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"170\",\"label\":\"Contrato laboral temporal\",\"terms\":{\"totalCount\":0,\"items\":[]}}]},\"allowOther\":false,\"allowKey\":false,\"select\":{\"embedded\":true}},{\"code\":\"F010\",\"name\":\"Fi010\",\"label\":\"Tipo de dedicación\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"terms\":{\"totalCount\":2,\"items\":[{\"key\":\"020\",\"label\":\"Tiempo completo\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"030\",\"label\":\"Tiempo parcial\",\"terms\":{\"totalCount\":0,\"items\":[]}}]},\"allowOther\":false,\"allowKey\":false,\"select\":{\"embedded\":true}},{\"code\":\"F012\",\"name\":\"Fi012\",\"label\":\"Palabras clave dedicación\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":\"mfgs_fw\",\"allowOther\":false,\"allowKey\":false}]},\"view\":{\"show\":{\"fields\":[\"F008\",\"F009\",\"F010\",\"F011\",\"F029n\",\"F012\",\"F028\"]}}},{\"code\":\"F001\",\"name\":\"Fi001\",\"label\":\"Tipo de actividad\",\"type\":\"composite\",\"displays\":{\"totalCount\":0,\"items\":[]},\"extensible\":false,\"conditional\":false,\"fields\":{\"totalCount\":1,\"items\":[{\"code\":\"F002\",\"name\":\"Fi002\",\"label\":\"Es gestión docente\",\"type\":\"boolean\",\"displays\":{\"totalCount\":0,\"items\":[]}}]}},{\"code\":\"F013\",\"name\":\"Fi013\",\"label\":\"Especialidad\",\"type\":\"composite\",\"displays\":{\"totalCount\":0,\"items\":[]},\"extensible\":false,\"conditional\":false,\"fields\":{\"totalCount\":1,\"items\":[{\"code\":\"F025\",\"name\":\"Fi025\",\"label\":\"Área de especialización\",\"type\":\"composite\",\"displays\":{\"totalCount\":0,\"items\":[]},\"extensible\":false,\"conditional\":false,\"fields\":{\"totalCount\":3,\"items\":[{\"code\":\"F014\",\"name\":\"Fi014\",\"label\":\"Área de especialización primaria\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":\"mfgs_fw\",\"allowOther\":false,\"allowKey\":false},{\"code\":\"F015\",\"name\":\"Fi015\",\"label\":\"Área de especialización secundaria\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":\"mfgs_fw\",\"allowOther\":false,\"allowKey\":false},{\"code\":\"F016\",\"name\":\"Fi016\",\"label\":\"Área de especialización terciaria\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":\"mfgs_fw\",\"allowOther\":false,\"allowKey\":false}]},\"view\":{\"show\":{\"fields\":[\"F014\",\"F015\",\"F016\"]}}}]}},{\"code\":\"F017\",\"name\":\"Fi017\",\"label\":\"Periodo\",\"type\":\"composite\",\"displays\":{\"totalCount\":0,\"items\":[]},\"extensible\":false,\"conditional\":false,\"fields\":{\"totalCount\":2,\"items\":[{\"code\":\"F018\",\"name\":\"Fi018\",\"label\":\"Fecha de inicio\",\"type\":\"date\",\"required\":true,\"displays\":{\"totalCount\":0,\"items\":[]},\"precision\":\"DAYS\"},{\"code\":\"F019\",\"name\":\"Fi019\",\"label\":\"Fecha de finalización\",\"type\":\"date\",\"required\":true,\"displays\":{\"totalCount\":0,\"items\":[]},\"precision\":\"DAYS\"}]},\"view\":{\"show\":{\"fields\":[\"F018\",\"F019\"]}}},{\"code\":\"F003\",\"name\":\"Fi003\",\"label\":\"Entidad\",\"type\":\"composite\",\"displays\":{\"totalCount\":0,\"items\":[]},\"extensible\":false,\"conditional\":false,\"fields\":{\"totalCount\":8,\"items\":[{\"code\":\"F020\",\"name\":\"Fi020\",\"label\":\"Dirección postal\",\"type\":\"text\",\"displays\":{\"totalCount\":0,\"items\":[]},\"patterns\":[]},{\"code\":\"F021\",\"name\":\"Fi021\",\"label\":\"Teléfono\",\"type\":\"text\",\"displays\":{\"totalCount\":0,\"items\":[]},\"patterns\":[]},{\"code\":\"F022\",\"name\":\"Fi022\",\"label\":\"Fax\",\"type\":\"text\",\"displays\":{\"totalCount\":0,\"items\":[]},\"patterns\":[]},{\"code\":\"F023\",\"name\":\"Fi023\",\"label\":\"Correo electrónico\",\"type\":\"text\",\"displays\":{\"totalCount\":0,\"items\":[]},\"patterns\":[]},{\"code\":\"F004\",\"name\":\"Fi004\",\"label\":\"Nombre de la entidad\",\"type\":\"link\",\"required\":true,\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":{\"index\":\"mu_sfca\",\"filters\":[]},\"allowAdd\":false,\"allowSearch\":false},{\"code\":\"F005\",\"name\":\"Fi005\",\"label\":\"Facultad, escuela, etc.\",\"type\":\"link\",\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":{\"index\":\"mu_sfca\",\"filters\":[]},\"allowAdd\":false,\"allowSearch\":false},{\"code\":\"F006\",\"name\":\"Fi006\",\"label\":\"Departamento, servicio, etc.\",\"type\":\"link\",\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":{\"index\":\"mu_sfca\",\"filters\":[]},\"allowAdd\":false,\"allowSearch\":false},{\"code\":\"F024\",\"name\":\"Fi024\",\"label\":\"Lugar de trabajo\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"source\":\"m1rsupg\",\"allowOther\":false,\"allowKey\":false}]},\"view\":{\"show\":{\"fields\":[\"F004\",\"F005\",\"F006\",\"F020\",\"F024\",\"F021\",\"F022\",\"F023\"]}}},{\"code\":\"F027\",\"name\":\"Fi027\",\"label\":\"Tipo de actividad de gestión\",\"type\":\"select\",\"displays\":{\"totalCount\":0,\"items\":[]},\"terms\":{\"totalCount\":5,\"items\":[{\"key\":\"000\",\"label\":\"Universitaria\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"010\",\"label\":\"OPIs\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"020\",\"label\":\"Comunidades Autónomas\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"030\",\"label\":\"Administración General del Estado\",\"terms\":{\"totalCount\":0,\"items\":[]}},{\"key\":\"OTHERS\",\"label\":\"Otros\",\"terms\":{\"totalCount\":0,\"items\":[]}}]},\"allowOther\":false,\"allowKey\":false}]}}"));

        new NodeDefinitionAdapter(null).adapt(node, definition);
    }

}