package client.services.http.builders.types;

import client.ApplicationTestCase;
import client.core.model.types.TermCategory;
import client.core.model.types.TermList;
import client.services.http.HttpList;
import com.google.gwt.core.client.JsonUtils;
import org.junit.Test;

public class TermBuilderTest extends ApplicationTestCase {

    private static final String JSON_TERM_LIST = "{\"totalCount\":312,\"items\":[{\"value\":\"004\",\"label\":\"Afganistán\"},{\"value\":\"4\",\"label\":\"Afganistán\"},{\"value\":\"008\",\"label\":\"Albania\"},{\"value\":\"8\",\"label\":\"Albania\"},{\"value\":\"276\",\"label\":\"Alemania\"},{\"value\":\"280\",\"label\":\"Alemania (Rpt)\"},{\"value\":\"996\",\"label\":\"Altos del Golán\"},{\"value\":\"020\",\"label\":\"Andorra\"},{\"value\":\"20\",\"label\":\"Andorra\"},{\"value\":\"024\",\"label\":\"Angola\"}]}";
    private static final String TERM_DEFINITION_WITH_CATEGORY = "{\"totalCount\":48,\"items\":[{\"value\":\"ic2\", \"label\":\"Docencia\",\"terms\":{\"totalCount\":10,\"items\":[{\"value\":\"t.ic.030.040\", \"label\":\"Dirección de Tesis y Proyectos\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.030.010\",  \"label\":\"Docencia impartida\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.030.070\",  \"label\":\"Elaboración de material docente\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.100\",  \"label\":\"Elaboración de protocolos de atención a la salud\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.140\",  \"label\":\"Otra actividad\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.030.090\",  \"label\":\"Ponencia de innovación docente\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.030.020\",  \"label\":\"Programa de Formación Sanitaria Especializada Impartida\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.030.080\",  \"label\":\"Proyecto de innovación docente\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.030.050\",  \"label\":\"Tutoría académica\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.080\",  \"label\":\"Tutoría de atención salud\",  \"terms\":[   ],  \"type\":\"term\"  }  ]  },  \"type\":\"category\"  },  {  \"value\":\"ic3\",  \"label\":\"I+D+i\",  \"terms\":{  \"totalCount\":13,  \"items\":[  {  \"value\":\"t.ic.060.030.060\",  \"label\":\"Carrera profesional\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.010.050\",  \"label\":\"Estancia en centros I+D+i\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.020.060\",  \"label\":\"Experiencia evaluación I+D\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.020.040\",  \"label\":\"Gestión de I+D+i\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.050.020.030\",  \"label\":\"Obras artísticas dirigidas\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.020.030\",  \"label\":\"Organización actividad I+D+i\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.050.010\",  \"label\":\"Participación grupos I+D+i\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.050.030.010\",  \"label\":\"Propiedad intelectual e industrial\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.110\",  \"label\":\"Proyecto de Innovación Sanitaria\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.120\",  \"label\":\"Proyecto de planificación/mejora sanitaria\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.050.020.010\",  \"label\":\"Proyectos I+D+i\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.010.010\",  \"label\":\"Publicación Científica o Técnica\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.010.020\",  \"label\":\"Trabajo de divulgación\",  \"terms\":[   ],  \"type\":\"term\"  }  ]  },  \"type\":\"category\"  },  {  \"value\":\"ic4\",  \"label\":\"Méritos\",  \"terms\":{  \"totalCount\":10,  \"items\":[  {  \"value\":\"t.ic.060.030.010\",  \"label\":\"Ayuda y Beca Obtenida\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.020.010\",  \"label\":\"Comités científicos\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.030.100\",  \"label\":\"Compendio de otros méritos\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.030.040\",  \"label\":\"Pertenencia a redes\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.030.020\",  \"label\":\"Pertenencia a sociedades científicas y/o profesionales\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.030.080\",  \"label\":\"Premio innovación docente\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.030.090\",  \"label\":\"Reconocimiento de actividad docente\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.020.050\",  \"label\":\"Representación nacional en foros\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.030.050\",  \"label\":\"Título y premio obtenido\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.060.030.070\",  \"label\":\"Tramos de investigación\",  \"terms\":[   ],  \"type\":\"term\"  }  ]  },  \"type\":\"category\"  },  {  \"value\":\"ic1\",  \"label\":\"Perfil\",  \"terms\":{  \"totalCount\":11,  \"items\":[  {  \"value\":\"t.ic.010.010\",  \"label\":\"Cargo y actividad desempeñada\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.020.060\",  \"label\":\"Conocimiento de idiomas\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.090\",  \"label\":\"Curso y seminario impartido en el campo de la salud\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.030.060\",  \"label\":\"Cursos y seminarios impartidos\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.020.010.010\",  \"label\":\"Diplomatura, licenciatura e ingeniería\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.020.050\",  \"label\":\"Diplomatura, licenciatura e ingeniería\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.010\",  \"label\":\"Experiencias en instituciones de la UE\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.020.020\",  \"label\":\"Formación distinta a la académica reglada y a la sanitaria\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.020.010.020\",  \"label\":\"Otra formación universitaria\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.040.130\",  \"label\":\"Ponencia de atención a la salud\",  \"terms\":[   ],  \"type\":\"term\"  },  {  \"value\":\"t.ic.020.030\",  \"label\":\"Programa de formación sanitaria especializada recibida\",\"terms\":[ ],\"type\":\"term\"}]},\"type\":\"category\"}]}";

    @Test
    public void testBuildTermList() {
        final TermBuilder builder = new TermBuilder();
        final TermList terms = builder.buildList((HttpList) JsonUtils.safeEval(JSON_TERM_LIST));
        assertEquals(312, terms.getTotalCount());
        assertEquals(10, terms.size());
    }

    @Test
    public void testCreateTermDefinitionFromJson() {
        TermBuilder builder = new TermBuilder();
        TermList terms = builder.buildList((HttpList) JsonUtils.safeEval(TERM_DEFINITION_WITH_CATEGORY));

        assertEquals(48, terms.getTotalCount());
        assertEquals(10, ((TermCategory) terms.get(0)).getTerms().size());
        assertEquals(13, ((TermCategory) terms.get(1)).getTerms().size());
        assertEquals(10, ((TermCategory) terms.get(2)).getTerms().size());
        assertEquals(11, ((TermCategory) terms.get(3)).getTerms().size());
    }
}
